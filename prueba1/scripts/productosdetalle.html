<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Detalle del producto</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    .thumb { width: 70px; height: 70px; object-fit: cover; cursor: pointer; border: 2px solid transparent; }
    .thumb.active { border-color: #0d6efd; }
    .main-img { width: 100%; max-height: 420px; object-fit: contain; background: #f8f9fa; }
    .card-img-top { height: 220px; object-fit: contain; background: #f8f9fa; } /* evita recorte */
  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg bg-white shadow-sm fixed-top">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center" href="../../index.html">
      <img src="../assets/LosTralaleros.png" alt="Logo" width="30" height="30" class="me-2">
      <span class="fw-bold text-primary">Los Tralaleros</span>
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="Menú">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item"><a class="nav-link" href="../../index.html">Inicio</a></li>
        <li class="nav-item"><a class="nav-link" href="productos.html">Productos</a></li>
        <li class="nav-item"><a class="nav-link" href="Blogs.html">Blogs</a></li>
        <li class="nav-item"><a class="nav-link" href="indexblog.html">Nosotros</a></li>
        <li class="nav-item"><a class="nav-link" href="contacto.html">Contacto</a></li>
      </ul>
    </div>
    <div class="d-flex align-items-center">
      <a href="../sesion/login.html" class="me-3"><i class="bi bi-person fs-4"></i></a>
      <div class="dropdown">
        <a href="#" class="btn btn-outline-dark position-relative dropdown-toggle" id="cartDropdown"
           data-bs-toggle="dropdown" aria-expanded="false">
          <i class="bi bi-cart fs-5"></i>
          <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="cartCount">0</span>
        </a>
        <ul class="dropdown-menu dropdown-menu-end p-3" aria-labelledby="cartDropdown" style="min-width: 300px;">
          <div id="cartList"></div>
        </ul>
      </div>
    </div>
  </div>
</nav>

<div class="pt-5 mt-4"></div>

<script src="./productos-data.js"></script>

<main class="container py-4">
  <nav class="small mb-3">
    <a href="../../index.html" class="text-decoration-none">Inicio</a> › <span id="breadcrumbName"></span>
  </nav>

  <div class="row g-4">
    <div class="col-lg-7">
      <img id="mainImg" class="main-img rounded" src="" alt="Producto">
      <div class="d-flex gap-2 mt-3" id="thumbs"></div>
    </div>
    <div class="col-lg-5">
      <h2 id="pName" class="mb-2"></h2>
      <h4 class="text-primary mb-3" id="pPrice"></h4>
      <p id="pDesc" class="text-muted"></p>
      <div class="d-flex align-items-center gap-3 my-3">
        <label for="qty" class="form-label m-0">Cantidad</label>
        <div class="input-group" style="max-width: 160px;">
          <button class="btn btn-outline-secondary" type="button" id="qtyMinus">-</button>
          <input id="qty" type="number" class="form-control text-center" value="1" min="1">
          <button class="btn btn-outline-secondary" type="button" id="qtyPlus">+</button>
        </div>
      </div>
      <button id="addBtn" class="btn btn-primary btn-lg w-100">Añadir al carrito</button>
    </div>
  </div>

  <hr class="my-5">

  <section>
    <h5 class="mb-3">Productos relacionados</h5>
    <div class="row g-3" id="related"></div>
  </section>
</main>

<footer class="text-center py-4 text-muted">© 2025 Los Tralaleros Corp.</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="../scripts/carrito.js"></script>

<script>
const params = new URLSearchParams(location.search);
const id = params.get("id");
const product = window.getProductById ? getProductById(id) : null;

if (!product) {
  document.body.insertAdjacentHTML('afterbegin','<div class="alert alert-warning m-3">Producto no encontrado.</div>');
} else {
  document.getElementById("breadcrumbName").textContent = product.name;
  document.getElementById("pName").textContent = product.name;
  document.getElementById("pPrice").textContent = `$${product.price.toLocaleString('es-CL')}`;
  document.getElementById("pDesc").textContent = product.desc;

  const mainImg = document.getElementById("mainImg");
  const gallery = (product.images && product.images.length ? product.images : [product.img]);
  mainImg.src = gallery[0];

  const thumbs = document.getElementById("thumbs");
  gallery.forEach((src, i) => {
    const im = document.createElement("img");
    im.src = src;
    im.className = "thumb rounded" + (i===0 ? " active" : "");
    im.addEventListener("click", () => {
      document.querySelectorAll(".thumb").forEach(t => t.classList.remove("active"));
      im.classList.add("active");
      mainImg.src = src;
    });
    thumbs.appendChild(im);
  });

  const qty = document.getElementById("qty");
  document.getElementById("qtyMinus").onclick = () => qty.value = Math.max(1, parseInt(qty.value || 1) - 1);
  document.getElementById("qtyPlus").onclick  = () => qty.value = Math.max(1, parseInt(qty.value || 1) + 1);
  document.getElementById("addBtn").onclick   = () => addToCart(product.name, product.price, Math.max(1, parseInt(qty.value || 1)));

  const related = document.getElementById("related");
  (window.products || []).filter(p => p.id !== product.id).slice(0,4).forEach(p => {
    const col = document.createElement("div");
    col.className = "col-6 col-md-3";
    col.innerHTML = `
      <a href="productosdetalle.html?id=${p.id}" class="text-decoration-none text-dark">
        <div class="card h-100">
          <img src="${p.img}" class="card-img-top" alt="${p.name}">
          <div class="card-body p-2">
            <p class="m-0 small">${p.name}</p>
            <p class="m-0 text-primary fw-semibold">$${p.price.toLocaleString('es-CL')}</p>
          </div>
        </div>
      </a>`;
    related.appendChild(col);
  });
}
</script>
</body>
</html>

